<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>WaterROC - Admin Dashboard</title>
    <link rel="icon" type="image/png" href="/favicon.png">
    <link rel="shortcut icon" type="image/png" href="/favicon.png">
    <link rel="stylesheet" href="styles/main.css">
    <link rel="stylesheet" href="styles/gantt.css">
    <link rel="stylesheet" href="styles/hourly-gantt.css">
    <link rel="stylesheet" href="styles/company-chat.css">
    <link rel="stylesheet" href="styles/voip.css">
    <link rel="stylesheet" href="styles/gantt-context-menu.css">
    <script src="scripts/dark-mode.js" defer></script>
    <script src="scripts/gantt-context-menu.js" defer></script>
    <script src="scripts/hourly-gantt-context-menu.js" defer></script>
</head>
<body>
    <div class="dashboard">
        <header class="dashboard-header">
            <div class="header-left">
                <h1>WaterROC</h1>
            </div>
            <div class="header-right">
                <button id="notificationBtn" class="notification-btn">
                    ðŸ””
                    <span id="notificationBadge" class="notification-badge">0</span>
                </button>
                <span class="user-info">Admin Dashboard</span>
                <button id="logoutBtn" class="btn-secondary">Logout</button>
            </div>
        </header>
        
        <!-- Announcement Banner -->
        <div id="announcementBanner" class="announcement-banner-container"></div>
        
        <div class="dashboard-content">
            <div class="controls-panel">
                <div class="controls-section">
                    <h3>Gantt Chart Controls</h3>
                    <div class="control-group">
                        <button id="addEmployeeBtn" class="btn-primary">Add Personell</button>
                        <button id="addTaskBtn" class="btn-primary">Add Task</button>
                        <button id="sendAnnouncementBtn" class="btn-warning">Send Announcement</button>
                        <button id="viewAnalyticsBtn" class="btn-success">View Analytics</button>
                        <button id="saveDataBtn" class="btn-success">Save Changes</button>
                        <button id="resetViewBtn" class="btn-secondary">Reset View</button>
                    </div>
                </div>
                
                <div class="controls-section">
                    <h3>Date Range</h3>
                    <div class="date-controls">
                        <input type="date" id="startDate" />
                        <span>to</span>
                        <input type="date" id="endDate" />
                        <button id="updateDateRange" class="btn-secondary">Update</button>
                    </div>
                </div>
                
                <div class="controls-section">
                    <h3>Advanced Features</h3>
                    <div class="control-group">
                        <button id="manageProfilesBtn" class="btn-primary">Personell Profiles</button>
                        <button id="manageShiftsBtn" class="btn-primary">Shift Scheduling</button>
                        <button id="manageTaskTemplatesBtn" class="btn-primary">Task Templates</button>
                        <button id="manageExceptionsBtn" class="btn-warning">Exceptions & Absence</button>
                    </div>
                </div>
                
                <div class="controls-section">
                    <h3>Color Legend</h3>
                    <div class="color-legend">
                        <div class="legend-item">
                            <span class="color-box" style="background-color: #3b82f6;"></span>
                            <span>In Progress</span>
                        </div>
                        <div class="legend-item">
                            <span class="color-box" style="background-color: #10b981;"></span>
                            <span>Completed</span>
                        </div>
                        <div class="legend-item">
                            <span class="color-box" style="background-color: #f59e0b;"></span>
                            <span>Pending</span>
                        </div>
                        <div class="legend-item">
                            <span class="color-box" style="background-color: #ef4444;"></span>
                            <span>Overdue</span>
                        </div>
                        <div class="legend-item">
                            <span class="color-box" style="background-color: #8b5cf6;"></span>
                            <span>On Hold</span>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="gantt-container">
                <div id="ganttChart" class="gantt-chart"></div>
            </div>
        </div>
    </div>
    
    <!-- Add Employee Modal -->
    <div id="addEmployeeModal" class="modal">
        <div class="modal-content">
            <span class="close">&times;</span>
            <h2>Add Employee</h2>
            <form id="addEmployeeForm">
                <div class="form-group">
                    <label for="linkUserAccount">Link to User Account (Optional)</label>
                    <select id="linkUserAccount">
                        <option value="">-- No User Account --</option>
                    </select>
                    <small style="color: #64748b; display: block; margin-top: 4px;">
                        Select a user to link their login account to this employee
                    </small>
                </div>
                <div class="form-group">
                    <label for="employeeName">Employee Name</label>
                    <input type="text" id="employeeName" required>
                </div>
                <div class="form-group">
                    <label for="employeeRole">Role/Position</label>
                    <input type="text" id="employeeRole" required>
                </div>
                <button type="submit" class="btn-primary">Add Employee</button>
            </form>
        </div>
    </div>
    
    <!-- Add Task Modal -->
    <div id="addTaskModal" class="modal">
        <div class="modal-content">
            <span class="close">&times;</span>
            <h2>Add Task</h2>
            <form id="addTaskForm">
                <div class="form-group">
                    <label>
                        <input type="checkbox" id="taskSendToAll" style="margin-right: 8px;">
                        Send to all employees
                    </label>
                </div>
                <div class="form-group" id="taskEmployeeGroup">
                    <label for="taskEmployee">Employee</label>
                    <select id="taskEmployee" required></select>
                </div>
                <div class="form-group">
                    <label for="taskName">Task Name</label>
                    <input type="text" id="taskName" required>
                </div>
                <div class="form-group">
                    <label for="taskStart">Start Date</label>
                    <input type="date" id="taskStart" required>
                </div>
                <div class="form-group">
                    <label for="taskStartTime">Start Time (HHMM)</label>
                    <input type="time" id="taskStartTime" required>
                </div>
                <div class="form-group">
                    <label for="taskEnd">End Date</label>
                    <input type="date" id="taskEnd" required>
                </div>
                <div class="form-group">
                    <label for="taskEndTime">End Time (HHMM)</label>
                    <input type="time" id="taskEndTime" required>
                </div>
                <div class="form-group">
                    <label for="taskStatus">Status</label>
                    <select id="taskStatus" required>
                        <option value="pending">Pending</option>
                        <option value="in-progress">In Progress</option>
                        <option value="completed">Completed</option>
                        <option value="overdue">Overdue</option>
                        <option value="on-hold">On Hold</option>
                    </select>
                </div>
                <button type="submit" class="btn-primary">Add Task</button>
            </form>
        </div>
    </div>

    <!-- Shift Scheduling / Attendance Modal -->
    <div id="shiftSchedulingModal" class="modal">
        <div class="modal-content" style="max-width: 900px;">
            <div class="modal-header">
                <h2>ðŸ•’ Shift Scheduling & Attendance</h2>
                <span class="close">&times;</span>
            </div>
            <div class="modal-body">
                <p>Below are clock-in/out sessions grouped by employee. Shows recent sessions.</p>
                <div id="attendanceByEmployee">Loading attendance...</div>
            </div>
            <div class="modal-actions">
                <button id="closeShiftScheduling" class="btn-secondary">Close</button>
            </div>
        </div>
    </div>
    
    <!-- Edit Task Modal -->
    <div id="editTaskModal" class="modal">
        <div class="modal-content modal-content-large">
            <span class="close">&times;</span>
            <h2>Edit Task</h2>
            <form id="editTaskForm">
                <input type="hidden" id="editTaskId">
                <div class="form-group">
                    <label for="editTaskName">Task Name</label>
                    <input type="text" id="editTaskName" required>
                </div>
                <div class="form-group">
                    <label for="editTaskStart">Start Date</label>
                    <input type="date" id="editTaskStart" required>
                </div>
                <div class="form-group">
                    <label for="editTaskStartTime">Start Time</label>
                    <input type="time" id="editTaskStartTime" required>
                </div>
                <div class="form-group">
                    <label for="editTaskEnd">End Date</label>
                    <input type="date" id="editTaskEnd" required>
                </div>
                <div class="form-group">
                    <label for="editTaskEndTime">End Time</label>
                    <input type="time" id="editTaskEndTime" required>
                </div>
                <div class="form-group">
                    <label for="editTaskStatus">Status</label>
                    <select id="editTaskStatus" required>
                        <option value="pending">Pending</option>
                        <option value="in-progress">In Progress</option>
                        <option value="completed">Completed</option>
                        <option value="overdue">Overdue</option>
                        <option value="on-hold">On Hold</option>
                    </select>
                </div>
                <div id="taskAcknowledgements" class="task-acknowledgements-section">
                    <h3>Task Acknowledgements</h3>
                    <div id="ackList" class="ack-list"></div>
                </div>
                
                <!-- Task Messages Section -->
                <div class="task-messages-section">
                    <h3>ðŸ’¬ Messages</h3>
                    <div id="taskMessagesList" class="task-messages-list">
                        <!-- Messages will be rendered here -->
                    </div>
                    <div class="task-message-input">
                        <textarea id="adminMessageInput" placeholder="Reply to employee messages..." rows="3"></textarea>
                        <button type="button" id="sendAdminMessageBtn" class="btn-primary">Send Reply</button>
                    </div>
                </div>
                
                <div class="form-actions">
                    <button type="submit" class="btn-primary">Save Changes</button>
                    <button type="button" id="deleteTaskBtn" class="btn-danger">Delete Task</button>
                </div>
            </form>
        </div>
    </div>
    
    <!-- Announcement Modal -->
    <div id="announcementModal" class="modal">
        <div class="modal-content">
            <span class="close">&times;</span>
            <h2>ðŸ“¢ Send Global Announcement</h2>
            <form id="announcementForm">
                <div class="form-group">
                    <label for="announcementTitle">Announcement Title</label>
                    <input type="text" id="announcementTitle" placeholder="e.g., Team Meeting Tomorrow" required>
                </div>
                <div class="form-group">
                    <label for="announcementMessage">Message</label>
                    <textarea id="announcementMessage" rows="6" placeholder="Enter your announcement message..." required></textarea>
                </div>
                <div class="form-group">
                    <label for="announcementPriority">Priority</label>
                    <select id="announcementPriority">
                        <option value="normal">Normal</option>
                        <option value="important">Important</option>
                        <option value="urgent">Urgent</option>
                    </select>
                </div>
                <div class="form-actions">
                    <button type="submit" class="btn-primary">Send to All Employees</button>
                    <button type="button" class="btn-secondary" id="cancelAnnouncementBtn">Cancel</button>
                </div>
            </form>
        </div>
    </div>
    
    <!-- Notification Panel -->
    <div class="notification-overlay" id="notificationOverlay"></div>
    <div class="notification-panel" id="notificationPanel">
        <div class="notification-header">
            <h3>ðŸ”” Notifications</h3>
            <div class="notification-actions">
                <button class="notification-action-btn" id="markAllReadBtn">Mark all read</button>
                <button class="notification-action-btn" id="clearAllBtn">Clear</button>
                <button class="notification-action-btn" id="closeNotificationBtn">âœ•</button>
            </div>
        </div>
        <div class="notification-list" id="notificationList">
            <!-- Notifications will be rendered here -->
        </div>
    </div>

    <!-- Hourly Gantt Modal -->
    <div id="hourlyGanttModal" class="modal">
        <div class="modal-content modal-content-xlarge">
            <span class="close" id="closeHourlyGantt">&times;</span>
            <h2 id="hourlyGanttTitle">Hourly Schedule - Loading...</h2>
            <div class="hourly-gantt-controls">
                <button class="btn-primary" id="addHourlyTaskBtn">+ Add Hourly Task</button>
            </div>
            <div id="hourlyGanttChart" class="hourly-gantt-chart"></div>
        </div>
    </div>

    <!-- Add Hourly Task Modal -->
    <div id="addHourlyTaskModal" class="modal">
        <div class="modal-content">
            <span class="close" id="closeAddHourlyTask">&times;</span>
            <h2>Add Hourly Task</h2>
            <form id="addHourlyTaskForm">
                <div class="form-group">
                    <label for="hourlyTaskEmployee">Employee</label>
                    <select id="hourlyTaskEmployee" required>
                        <option value="">Select Employee</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="hourlyTaskName">Task Name</label>
                    <input type="text" id="hourlyTaskName" required>
                </div>
                <div class="form-group">
                    <label for="hourlyTaskCategory">Category</label>
                    <select id="hourlyTaskCategory" required>
                        <option value="">Select Category</option>
                        <option value="music-prod">Music Prod.</option>
                        <option value="video-creation">Video Creation</option>
                        <option value="administrative">Administrative</option>
                        <option value="other">Other</option>
                        <option value="note-other">Note - Other</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="hourlyTaskStartTime">Start Time</label>
                    <input type="time" id="hourlyTaskStartTime" required>
                </div>
                <div class="form-group">
                    <label for="hourlyTaskEndTime">End Time</label>
                    <input type="time" id="hourlyTaskEndTime" required>
                </div>
                <div class="form-group">
                    <label for="hourlyTaskStatus">Status</label>
                    <select id="hourlyTaskStatus" required>
                        <option value="pending">Pending</option>
                        <option value="in-progress">In Progress</option>
                        <option value="completed">Completed</option>
                        <option value="overdue">Overdue</option>
                        <option value="on-hold">On Hold</option>
                    </select>
                </div>
                <button type="submit" class="btn-primary">Add Task</button>
            </form>
        </div>
    </div>

    <!-- Edit Hourly Task Modal -->
    <div id="editHourlyTaskModal" class="modal">
        <div class="modal-content">
            <span class="close" id="closeEditHourlyTask">&times;</span>
            <h2>Edit Hourly Task</h2>
            <form id="editHourlyTaskForm">
                <input type="hidden" id="editHourlyTaskId">
                
                <div class="form-group">
                    <label for="editHourlyTaskName">Task Name</label>
                    <input type="text" id="editHourlyTaskName" required>
                </div>
                
                <div class="form-group">
                    <label for="editHourlyTaskCategory">Category</label>
                    <select id="editHourlyTaskCategory" required>
                        <option value="music-prod">Music Prod.</option>
                        <option value="video-creation">Video Creation</option>
                        <option value="administrative">Administrative</option>
                        <option value="other">Other</option>
                        <option value="note-other">Note - Other</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label for="editHourlyTaskStartTime">Start Time</label>
                    <input type="time" id="editHourlyTaskStartTime" required>
                </div>
                
                <div class="form-group">
                    <label for="editHourlyTaskEndTime">End Time</label>
                    <input type="time" id="editHourlyTaskEndTime" required>
                </div>
                
                <div class="form-group">
                    <label for="editHourlyTaskStatus">Status</label>
                    <select id="editHourlyTaskStatus" required>
                        <option value="pending">Pending</option>
                        <option value="in-progress">In Progress</option>
                        <option value="completed">Completed</option>
                        <option value="overdue">Overdue</option>
                        <option value="on-hold">On Hold</option>
                    </select>
                </div>
                
                <div class="form-actions">
                    <button type="submit" class="btn-primary">Save Changes</button>
                    <button type="button" class="btn-danger" id="deleteHourlyTaskBtn">Delete Task</button>
                    <button type="button" class="btn-secondary" id="cancelEditHourlyTask">Cancel</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Edit Shift Modal -->
    <div id="editShiftModal" class="modal">
        <div class="modal-content">
            <span class="close" id="closeEditShift">&times;</span>
            <h2>Edit Shift Time</h2>
            <form id="editShiftForm">
                <input type="hidden" id="editShiftEmployeeId">
                <input type="hidden" id="editShiftDate">
                <input type="hidden" id="editShiftId">
                
                <div class="form-group">
                    <label for="editShiftEmployeeName">Employee</label>
                    <input type="text" id="editShiftEmployeeName" disabled>
                </div>
                
                <div class="form-group">
                    <label for="editShiftStartTime">Start Time</label>
                    <input type="time" id="editShiftStartTime" required>
                </div>
                
                <div class="form-group">
                    <label for="editShiftEndTime">End Time</label>
                    <input type="time" id="editShiftEndTime" required>
                </div>
                
                <div class="form-actions">
                    <button type="submit" class="btn-primary">Update Shift</button>
                    <button type="button" class="btn-secondary" id="cancelEditShift">Cancel</button>
                </div>
            </form>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script>
        // Immediate authentication check - runs before page loads
        (function() {
            const employmentStatus = sessionStorage.getItem('employmentStatus');
            const userRole = sessionStorage.getItem('userRole');
            
            // Check if user is on extended leave
            if (employmentStatus === 'extended_leave') {
                window.location.href = 'extended-leave.html';
                return;
            }
            
            // Check if user is authenticated as admin
            if (!userRole || userRole !== 'admin') {
                window.location.href = 'index.html';
                return;
            }
        })();
    </script>
    <script src="scripts/supabase.js"></script>
    <script src="scripts/config.js"></script>
    <script src="scripts/employee-status-monitor.js"></script>
    <script src="scripts/checkin.js"></script>
    <script src="scripts/time-admin.js"></script>
    <script src="scripts/notifications.js"></script>
    <script src="scripts/announcement-banner.js"></script>
    <script src="scripts/gantt.js"></script>
    <script src="scripts/hourly-gantt.js"></script>
    <script src="scripts/admin.js"></script>
    <script src="scripts/company-chat.js"></script>
    <script src="scripts/voip-call-manager.js"></script>
    <script src="scripts/voip-ui.js"></script>
    <script>
        // Initialize VOIP on page load
        document.addEventListener('DOMContentLoaded', async () => {
            if (typeof voipUI !== 'undefined') {
                await voipUI.initialize();
            }
        });
    </script>
</body>
</html>
