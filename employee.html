<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>WaterROC - Employee Dashboard</title>
    <link rel="stylesheet" href="styles/main.css">
    <link rel="stylesheet" href="styles/gantt.css">
    <link rel="stylesheet" href="styles/checkin.css">
    <link rel="stylesheet" href="styles/company-chat.css">
    <link rel="stylesheet" href="styles/employee-layout-fix.css">
    <link rel="stylesheet" href="styles/voip.css">
</head>
<body class="employee-page">
    <div class="dashboard">
        <header class="dashboard-header">
            <div class="header-left">
                <h1>WaterROC</h1>
            </div>
            <div class="header-right">
                <button id="notificationBtn" class="notification-btn">
                    üîî
                    <span id="notificationBadge" class="notification-badge">0</span>
                </button>
                <span class="user-info">Employee View</span>
                <button id="clockInBtn" class="btn-primary" data-state="out">Clock In</button>
                <span id="clockStatus" style="margin:0 10px; font-weight:600;">Not clocked in</span>
                <button id="logoutBtn" class="btn-secondary">Logout</button>
            </div>
        </header>
        
        <!-- Announcement Banner -->
        <div id="announcementBanner" class="announcement-banner-container"></div>
        
        <div class="dashboard-content">
            <div class="info-panel">
                <div class="info-card">
                    <h3>Schedule Overview</h3>
                    <p>View your team's schedule and assignments</p>
                    <div style="margin-top: 15px; display: flex; gap: 10px; flex-wrap: wrap;">
                        <a href="employee-tasks.html" class="btn-primary" style="text-decoration: none;">üìã My Tasks</a>
                        <button id="viewMyShiftsBtn" class="btn-primary">My Shifts</button>
                        <button id="editMyProfileBtn" class="btn-primary">My Profile</button>
                        <button id="requestTimeOffBtn" class="btn-primary">Request Time Off</button>
                    </div>
                </div>
                
                <div class="info-card">
                    <h3>Task Status Legend</h3>
                    <div class="color-legend">
                        <div class="legend-item">
                            <span class="color-box" style="background-color: #2563eb;"></span>
                            <span>In Progress</span>
                        </div>
                        <div class="legend-item">
                            <span class="color-box" style="background-color: #059669;"></span>
                            <span>Completed</span>
                        </div>
                            <span>Completed</span>
                        </div>
                        <div class="legend-item">
                            <span class="color-box" style="background-color: #f59e0b;"></span>
                            <span>Pending</span>
                        </div>
                        <div class="legend-item">
                            <span class="color-box" style="background-color: #ef4444;"></span>
                            <span>Overdue</span>
                        </div>
                        <div class="legend-item">
                            <span class="color-box" style="background-color: #8b5cf6;"></span>
                            <span>On Hold</span>
                        </div>
                    </div>
                </div>
                
            </div>
            
            <div class="gantt-container">
                <div id="ganttChart" class="gantt-chart readonly"></div>
                
                <!-- Summary Section -->
                <div id="scheduleSummary" class="schedule-summary">
                    <h3>üìä Schedule Summary</h3>
                    <div class="summary-grid">
                        <div class="summary-card">
                            <div class="summary-icon">üìÖ</div>
                            <div class="summary-content">
                                <div class="summary-label">Upcoming Shifts</div>
                                <div class="summary-value" id="upcomingShiftsCount">-</div>
                            </div>
                        </div>
                        <div class="summary-card">
                            <div class="summary-icon">‚úÖ</div>
                            <div class="summary-content">
                                <div class="summary-label">Active Tasks</div>
                                <div class="summary-value" id="activeTasksCount">-</div>
                            </div>
                        </div>
                        <div class="summary-card">
                            <div class="summary-icon">‚è∞</div>
                            <div class="summary-content">
                                <div class="summary-label">Hours This Week</div>
                                <div class="summary-value" id="weeklyHours">-</div>
                            </div>
                        </div>
                        <div class="summary-card">
                            <div class="summary-icon">üìã</div>
                            <div class="summary-content">
                                <div class="summary-label">Tasks This Week</div>
                                <div class="summary-value" id="weeklyTasksCount">-</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Task Details Modal (Read-Only) -->
    <div id="taskDetailsModal" class="modal">
        <div class="modal-content modal-content-large">
            <span class="close">&times;</span>
            <h2>Task Details</h2>
            <div id="taskDetails" class="task-details-content"></div>
            <div class="task-actions">
                <button id="acknowledgeBtn" class="btn-success">‚úì Acknowledge Task</button>
                <button id="unacknowledgeBtn" class="btn-secondary" style="display:none;">Remove Acknowledgement</button>
            </div>
            
            <!-- Task Messages Section -->
            <div class="task-messages-section">
                <h3>üí¨ Messages</h3>
                <div id="taskMessagesList" class="task-messages-list">
                    <!-- Messages will be rendered here -->
                </div>
                <div class="task-message-input">
                    <textarea id="messageInput" placeholder="Ask a question or send a message to admin..." rows="3"></textarea>
                    <button id="sendMessageBtn" class="btn-primary">Send Message</button>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Notification Panel -->
    <div class="notification-overlay" id="notificationOverlay"></div>
    <div class="notification-panel" id="notificationPanel">
        <div class="notification-header">
            <h3>üîî Notifications</h3>
            <div class="notification-actions">
                <button class="notification-action-btn" id="markAllReadBtn">Mark all read</button>
                <button class="notification-action-btn" id="clearAllBtn">Clear</button>
                <button class="notification-action-btn" id="closeNotificationBtn">‚úï</button>
            </div>
        </div>
        <div class="notification-list" id="notificationList">
            <!-- Notifications will be rendered here -->
        </div>
    </div>

    <!-- My Shifts Modal -->
    <div id="myShiftsModal" class="modal">
        <div class="modal-content" style="max-width: 900px;">
            <div class="modal-header">
                <h2>üìÖ My Shifts</h2>
                <span class="close">&times;</span>
            </div>
            <div class="modal-body">
                <div style="margin-bottom: 20px; display: flex; justify-content: space-between; align-items: center;">
                    <button id="myShiftsPrevWeek" class="btn-secondary">‚Üê Previous Week</button>
                    <span id="myShiftsWeekDisplay" style="font-weight: 600;"></span>
                    <button id="myShiftsNextWeek" class="btn-secondary">Next Week ‚Üí</button>
                </div>
                <div id="myShiftsContent" style="overflow-x: auto;">
                    <div class="loading-message">Loading your shifts...</div>
                </div>
            </div>
        </div>
    </div>

    <!-- My Profile Modal -->
    <div id="myProfileModal" class="modal">
        <div class="modal-content" style="max-width: 600px;">
            <div class="modal-header">
                <h2>üë§ My Profile</h2>
                <span class="close">&times;</span>
            </div>
            <form id="myProfileForm">
                <div class="form-group">
                    <label for="myProfileName">Name</label>
                    <input type="text" id="myProfileName" readonly>
                </div>

                <div class="form-group">
                    <label for="myProfilePhone">Phone Number</label>
                    <input type="tel" id="myProfilePhone" placeholder="(555) 123-4567">
                </div>

                <div class="form-group">
                    <label for="myProfileEmail">Email</label>
                    <input type="email" id="myProfileEmail" placeholder="your.email@example.com">
                </div>

                <div class="form-group">
                    <label for="myProfileSkills">Skills (comma-separated)</label>
                    <input type="text" id="myProfileSkills" placeholder="Plumbing, Welding, Electrical">
                    <small>Enter your skills separated by commas</small>
                </div>

                <div class="form-group">
                    <label for="myProfileCertifications">Certifications (comma-separated)</label>
                    <input type="text" id="myProfileCertifications" placeholder="EPA Cross-Connection, Backflow Prevention">
                    <small>Enter your certifications separated by commas</small>
                </div>

                <div class="modal-actions">
                    <button type="button" class="btn-secondary" id="cancelMyProfileBtn">Cancel</button>
                    <button type="submit" class="btn-primary">üíæ Save Profile</button>
                </div>
            </form>
        </div>
    </div>
    
    <!-- Time Off Request Modal -->
    <div id="timeOffModal" class="modal">
        <div class="modal-content" style="max-width: 600px;">
            <div class="modal-header">
                <h2>üèñÔ∏è Request Time Off</h2>
                <button class="close-modal" id="closeTimeOffModal">&times;</button>
            </div>
            <form id="timeOffForm">
                <div class="form-group">
                    <label for="timeOffStartDate">Start Date</label>
                    <input type="date" id="timeOffStartDate" required>
                </div>

                <div class="form-group">
                    <label for="timeOffEndDate">End Date</label>
                    <input type="date" id="timeOffEndDate" required>
                </div>

                <div class="form-group">
                    <label for="timeOffReason">Reason</label>
                    <textarea id="timeOffReason" rows="4" placeholder="Enter reason for time off..." required></textarea>
                </div>

                <div class="modal-actions">
                    <button type="button" class="btn-secondary" id="cancelTimeOffBtn">Cancel</button>
                    <button type="submit" class="btn-primary">üì§ Submit Request</button>
                </div>
            </form>

            <!-- My Time Off Requests List -->
            <div style="margin-top: 30px; border-top: 1px solid #e5e7eb; padding-top: 20px;">
                <h3>My Time Off Requests</h3>
                <div id="myTimeOffRequestsList"></div>
            </div>
        </div>
    </div>
    
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script>
        // Immediate authentication check - runs before page loads
        (function() {
            const employmentStatus = sessionStorage.getItem('employmentStatus');
            const userRole = sessionStorage.getItem('userRole');
            
            // Check if user is on extended leave
            if (employmentStatus === 'extended_leave') {
                window.location.href = 'extended-leave.html';
                return;
            }
            
            // Check if user is authenticated
            if (!userRole || userRole !== 'employee') {
                window.location.href = 'index.html';
                return;
            }
        })();
    </script>
    <script src="scripts/supabase.js"></script>
    <script src="scripts/config.js"></script>
    <script src="scripts/employee-status-monitor.js"></script>
    <script src="scripts/clock-in.js"></script>
    <script src="scripts/checkin.js"></script>
    <script src="scripts/notifications.js"></script>
    <script src="scripts/announcement-banner.js"></script>
    <script src="scripts/gantt.js"></script>
    <script src="scripts/employee.js"></script>
    <script src="scripts/company-chat.js"></script>
    <script src="scripts/voip-call-manager.js"></script>
    <script src="scripts/voip-ui.js"></script>
    <script>
        // Initialize VOIP on page load
        document.addEventListener('DOMContentLoaded', async () => {
            if (typeof voipUI !== 'undefined') {
                await voipUI.initialize();
            }
        });
    </script>
</script>
</body>
</html>
